!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-post-process",["babylonjs"],e):"object"==typeof exports?exports["babylonjs-post-process"]=e(require("babylonjs")):t.POSTPROCESSES=e(t.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(function(t){return(()=>{"use strict";var e={520:e=>{e.exports=t}},i={};function o(t){var r=i[t];if(void 0!==r)return r.exports;var n=i[t]={exports:{}};return e[t](n,n.exports,o),n.exports}o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{o.d(r,{default:()=>f});var t={};o.r(t),o.d(t,{AsciiArtFontTexture:()=>a,AsciiArtPostProcess:()=>l,DigitalRainFontTexture:()=>s,DigitalRainPostProcess:()=>c});var e={};function i(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a}o.r(e),o.d(e,{AsciiArtFontTexture:()=>a,AsciiArtPostProcess:()=>l,DigitalRainFontTexture:()=>s,DigitalRainPostProcess:()=>c}),Object.create,Object.create;var n=o(520);n.ShaderStore.ShadersStore.asciiartPixelShader="varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D asciiArtFont;uniform vec4 asciiArtFontInfos;uniform vec4 asciiArtOptions;float getLuminance(vec3 color)\n{return clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{float caracterSize=asciiArtFontInfos.x;float numChar=asciiArtFontInfos.y-1.0;float fontx=asciiArtFontInfos.z;float fonty=asciiArtFontInfos.w;float screenx=asciiArtOptions.x;float screeny=asciiArtOptions.y;float tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;float tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;vec2 tileUV=vec2(tileX,tileY);vec4 tileColor=texture2D(textureSampler,tileUV);vec4 baseColor=texture2D(textureSampler,vUV);float tileLuminance=getLuminance(tileColor.rgb);float offsetx=(float(floor(tileLuminance*numChar)))*caracterSize/fontx;float offsety=0.0;float x=float(mod(gl_FragCoord.x,caracterSize))/fontx;float y=float(mod(gl_FragCoord.y,caracterSize))/fonty;vec4 finalColor= texture2D(asciiArtFont,vec2(offsetx+x,offsety+(caracterSize/fonty-y)));finalColor.rgb*=tileColor.rgb;finalColor.a=1.0;finalColor= mix(finalColor,tileColor,asciiArtOptions.w);finalColor= mix(finalColor,baseColor,asciiArtOptions.z);gl_FragColor=finalColor;}";class a extends n.BaseTexture{constructor(t,e,i,o=null){if(super(o),!(o=this.getScene()))return;this.name=t,this._text,this._font,this.wrapU=n.Texture.CLAMP_ADDRESSMODE,this.wrapV=n.Texture.CLAMP_ADDRESSMODE;const r=this.getFontHeight(e),a=this.getFontWidth(e);this._charSize=Math.max(r.height,a);const l=Math.ceil(this._charSize*i.length),s=this._charSize;this._texture=o.getEngine().createDynamicTexture(l,s,!1,n.Texture.NEAREST_SAMPLINGMODE);const c=this.getSize(),h=document.createElement("canvas");h.width=c.width,h.height=c.height;const f=h.getContext("2d");f.textBaseline="top",f.font=e,f.fillStyle="white",f.imageSmoothingEnabled=!1;for(let t=0;t<i.length;t++)f.fillText(i[t],t*this._charSize,-r.offset);o.getEngine().updateDynamicTexture(this._texture,h,!1,!0)}get charSize(){return this._charSize}getFontWidth(t){const e=document.createElement("canvas").getContext("2d");return e.fillStyle="white",e.font=t,e.measureText("W").width}getFontHeight(t){const e=document.createElement("canvas"),i=e.getContext("2d");i.fillRect(0,0,e.width,e.height),i.textBaseline="top",i.fillStyle="white",i.font=t,i.fillText("jH|",0,0);const o=i.getImageData(0,0,e.width,e.height).data;let r=-1,n=-1;for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++){if(0!==o[4*(t*e.width+i)]){-1===r&&(r=t);break}if(i===e.width-1&&-1!==r){n=t,t=e.height;break}}return{height:n-r+1,offset:r-1}}clone(){return new a(this.name,this._font,this._text,this.getScene())}static Parse(t,e){return n.SerializationHelper.Parse((()=>new a(t.name,t.font,t.text,e)),t,e,null)}}i([(0,n.serialize)("font")],a.prototype,"_font",void 0),i([(0,n.serialize)("text")],a.prototype,"_text",void 0);class l extends n.PostProcess{constructor(t,e,i){super(t,"asciiart",["asciiArtFontInfos","asciiArtOptions"],["asciiArtFont"],{width:e.getEngine().getRenderWidth(),height:e.getEngine().getRenderHeight()},e,n.Texture.TRILINEAR_SAMPLINGMODE,e.getEngine(),!0),this.mixToTile=0,this.mixToNormal=0;let o="40px Monospace",r=" `-.'_:,\"=^;<+!*?/cL\\zrs7TivJtC{3F)Il(xZfY5S2eajo14[nuyE]P6V9kXpKwGhqAUbOd8#HRDB0$mgMW&Q%N@";i&&("string"==typeof i?o=i:(o=i.font||o,r=i.characterSet||r,this.mixToTile=i.mixToTile||this.mixToTile,this.mixToNormal=i.mixToNormal||this.mixToNormal)),this._asciiArtFontTexture=new a(t,o,r,e.getScene());const l=this._asciiArtFontTexture.getSize();this.onApply=t=>{t.setTexture("asciiArtFont",this._asciiArtFontTexture),t.setFloat4("asciiArtFontInfos",this._asciiArtFontTexture.charSize,r.length,l.width,l.height),t.setFloat4("asciiArtOptions",this.width,this.height,this.mixToNormal,this.mixToTile)}}}n.ShaderStore.ShadersStore.digitalrainPixelShader="varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D digitalRainFont;uniform vec4 digitalRainFontInfos;uniform vec4 digitalRainOptions;uniform mat4 matrixSpeed;uniform float cosTimeZeroOne;float getLuminance(vec3 color)\n{return clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{float caracterSize=digitalRainFontInfos.x;float numChar=digitalRainFontInfos.y-1.0;float fontx=digitalRainFontInfos.z;float fonty=digitalRainFontInfos.w;float screenx=digitalRainOptions.x;float screeny=digitalRainOptions.y;float ratio=screeny/fonty;float columnx=float(floor((gl_FragCoord.x)/caracterSize));float tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;float tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;vec2 tileUV=vec2(tileX,tileY);vec4 tileColor=texture2D(textureSampler,tileUV);vec4 baseColor=texture2D(textureSampler,vUV);float tileLuminance=getLuminance(tileColor.rgb);int st=int(mod(columnx,4.0));float speed=cosTimeZeroOne*(sin(tileX*314.5)*0.5+0.6); \nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;float y=float(mod(speed+gl_FragCoord.y/screeny,1.0));y*=ratio;vec4 finalColor= texture2D(digitalRainFont,vec2(x,1.0-y));vec3 high=finalColor.rgb*(vec3(1.2,1.2,1.2)*pow(1.0-y,30.0));finalColor.rgb*=vec3(pow(tileLuminance,5.0),pow(tileLuminance,1.5),pow(tileLuminance,3.0));finalColor.rgb+=high;finalColor.rgb=clamp(finalColor.rgb,0.,1.);finalColor.a=1.0;finalColor= mix(finalColor,tileColor,digitalRainOptions.w);finalColor= mix(finalColor,baseColor,digitalRainOptions.z);gl_FragColor=finalColor;}";class s extends n.BaseTexture{constructor(t,e,i,o=null){if(super(o),!(o=this.getScene()))return;this.name=t,this._text,this._font,this.wrapU=n.Texture.CLAMP_ADDRESSMODE,this.wrapV=n.Texture.CLAMP_ADDRESSMODE;const r=this.getFontHeight(e),a=this.getFontWidth(e);this._charSize=Math.max(r.height,a);const l=this._charSize,s=Math.ceil(this._charSize*i.length);this._texture=o.getEngine().createDynamicTexture(l,s,!1,n.Texture.NEAREST_SAMPLINGMODE);const c=this.getSize(),h=document.createElement("canvas");h.width=c.width,h.height=c.height;const f=h.getContext("2d");f.textBaseline="top",f.font=e,f.fillStyle="white",f.imageSmoothingEnabled=!1;for(let t=0;t<i.length;t++)f.fillText(i[t],0,t*this._charSize-r.offset);o.getEngine().updateDynamicTexture(this._texture,h,!1,!0)}get charSize(){return this._charSize}getFontWidth(t){const e=document.createElement("canvas").getContext("2d");return e.fillStyle="white",e.font=t,e.measureText("W").width}getFontHeight(t){const e=document.createElement("canvas"),i=e.getContext("2d");i.fillRect(0,0,e.width,e.height),i.textBaseline="top",i.fillStyle="white",i.font=t,i.fillText("jH|",0,0);const o=i.getImageData(0,0,e.width,e.height).data;let r=-1,n=-1;for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++){if(0!==o[4*(t*e.width+i)]){-1===r&&(r=t);break}if(i===e.width-1&&-1!==r){n=t,t=e.height;break}}return{height:n-r+1,offset:r-1}}clone(){return new s(this.name,this._font,this._text,this.getScene())}static Parse(t,e){return n.SerializationHelper.Parse((()=>new s(t.name,t.font,t.text,e)),t,e,null)}}i([(0,n.serialize)("font")],s.prototype,"_font",void 0),i([(0,n.serialize)("text")],s.prototype,"_text",void 0);class c extends n.PostProcess{constructor(t,e,i){super(t,"digitalrain",["digitalRainFontInfos","digitalRainOptions","cosTimeZeroOne","matrixSpeed"],["digitalRainFont"],{width:e.getEngine().getRenderWidth(),height:e.getEngine().getRenderHeight()},e,n.Texture.TRILINEAR_SAMPLINGMODE,e.getEngine(),!0),this.mixToTile=0,this.mixToNormal=0,this.speed=.003;let o="15px Monospace";const r="古池や蛙飛び込む水の音ふるいけやかわずとびこむみずのおと初しぐれ猿も小蓑をほしげ也はつしぐれさるもこみのをほしげなり江戸の雨何石呑んだ時鳥えどのあめなんごくのんだほととぎす";i&&("string"==typeof i?o=i:(o=i.font||o,this.mixToTile=i.mixToTile||this.mixToTile,this.mixToNormal=i.mixToNormal||this.mixToNormal)),this._digitalRainFontTexture=new s(t,o,r,e.getScene());const a=this._digitalRainFontTexture.getSize();let l=0,c=0;const h=n.Matrix.FromValues(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random());this.onApply=t=>{t.setTexture("digitalRainFont",this._digitalRainFontTexture),t.setFloat4("digitalRainFontInfos",this._digitalRainFontTexture.charSize,r.length,a.width,a.height),t.setFloat4("digitalRainOptions",this.width,this.height,this.mixToNormal,this.mixToTile),t.setMatrix("matrixSpeed",h),l+=this.speed,c=l,t.setFloat("cosTimeZeroOne",c)}}}const h=void 0!==o.g?o.g:"undefined"!=typeof window?window:void 0;if(void 0!==h)for(const e in t)h.BABYLON[e]=t[e];const f=e})(),r.default})()}));
//# sourceMappingURL=babylonjs.postProcess.min.js.map